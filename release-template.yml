# Release template for a single stage

parameters:
- name: ProjectNameSuffix
  type: string
  default: ""
- name: ImageTagSuffix
  type: string

steps:
- checkout: self
- download: none
- task: DockerCompose@0
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryEndpoint: 'Github Packages'
    dockerComposeFile: 'docker-compose.yml'
    projectName: "$(underscoreName)${{ parameters.ProjectNameSuffix }}"
    action: 'Run services'
    buildImages: false
  env:
    IMAGE: ghcr.io/$(dockerRepository)
    IMAGE_TAG: $(tag)${{ parameters.ImageTagSuffix }}
    # Expose Secret Variables to env
    JWT_SECRET: $(JWT_SECRET)
    MAILGUN_API_KEY: $(MAILGUN_API_KEY)
    GP_WEBPAY_PRIV_KEY_PASS: $(GP_WEBPAY_PRIV_KEY_PASS)
    POSTGRES_PASSWORD: $(POSTGRES_PASSWORD)
    RECAPTCHA_CLIENT_SECRET: $(RECAPTCHA_CLIENT_SECRET)
